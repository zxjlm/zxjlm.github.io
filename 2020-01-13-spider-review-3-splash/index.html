<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#0078E7"><meta name="author" content="harumonia"><meta name="copyright" content="harumonia"><meta name="generator" content="Hexo 5.1.1"><meta name="theme" content="hexo-theme-yun"><title>python爬虫复习(3) splash &amp;&amp; 数据分析小试 | Zaxon</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme:light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme:dark)"><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"blog.harumonia.moe","root":"/","title":"Zaxon-迷雾中的藏宝地","version":"1.6.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};</script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="引入根据笔者以往的爬虫经验，大部分的爬虫是在静态网页上完成的，爬虫所要做的只不过是提交请求，然后分析返回的页面即可。当然，api 本质上也可以作为静态页面来处理。这意味着只要掌握 requests 就可以完成 60%-80%的爬虫任务。 这是一个很惊人的占比，这里解释一下，静态页面可能听起来很 low，但是有着以加载速度更快、易于维护为核心的一系列优势，尤其是引入了 ajax 之后，实现了动态加载"><meta property="og:type" content="article"><meta property="og:title" content="python爬虫复习(3) splash &amp;&amp; 数据分析小试"><meta property="og:url" content="https://blog.harumonia.moe/2020-01-13-spider-review-3-splash/index.html"><meta property="og:site_name" content="Zaxon"><meta property="og:description" content="引入根据笔者以往的爬虫经验，大部分的爬虫是在静态网页上完成的，爬虫所要做的只不过是提交请求，然后分析返回的页面即可。当然，api 本质上也可以作为静态页面来处理。这意味着只要掌握 requests 就可以完成 60%-80%的爬虫任务。 这是一个很惊人的占比，这里解释一下，静态页面可能听起来很 low，但是有着以加载速度更快、易于维护为核心的一系列优势，尤其是引入了 ajax 之后，实现了动态加载"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/01/13/CqSXPvtVJTDkrfw.png"><meta property="og:image" content="https://i.loli.net/2020/01/13/lPLvoERhY5k6UST.png"><meta property="og:image" content="https://i.loli.net/2020/01/13/rTLHkQO4gmvX5yf.png"><meta property="og:image" content="https://i.loli.net/2020/01/13/NAVtujdBlREgF5M.png"><meta property="article:published_time" content="2020-01-13T22:19:59.000Z"><meta property="article:modified_time" content="2020-01-13T22:19:59.000Z"><meta property="article:author" content="harumonia"><meta property="article:tag" content="spider"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/01/13/CqSXPvtVJTDkrfw.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="harumonia"><img width="96" loading="lazy" src="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/Ocabe.webp" alt="harumonia"></a><div class="site-author-name"><a href="/about/">harumonia</a></div><span class="site-name">Zaxon</span><sub class="site-subtitle">Find the key of soul</sub><div class="site-desciption">lazy</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">114</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">15</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">61</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=DSmoEtSKHITcV9pghYqqmSQ80-SPnPjm&amp;noverify=0" title="QQ" target="_blank" style="color:#12b7f5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/zxjlm" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/Zxj_Butterfly_m/" title="豆瓣" target="_blank" style="color:#072"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=305617499" title="网易云音乐" target="_blank" style="color:#c20c0c"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1801214" title="哔哩哔哩" target="_blank" style="color:#ff8eb3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/Harumonia1996" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:zxjlm233@gmail.com" title="E-Mail" target="_blank" style="color:#8e71c1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:#1e90ff"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color:#f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">引入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E-splash"><span class="toc-number">2.</span> <span class="toc-text">关于 splash</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85-amp-amp-%E8%BF%90%E8%A1%8C"><span class="toc-number">3.</span> <span class="toc-text">安装 &amp;&amp; 运行</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84-splash-%E5%BA%94%E7%94%A8"><span class="toc-number">4.</span> <span class="toc-text">一个简单的 splash 应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">4.1.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E7%8E%A9%E8%80%8D%E5%90%A7"><span class="toc-number">5.</span> <span class="toc-text">开始玩耍吧~</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B5%B7%E5%9B%A0"><span class="toc-number">5.1.</span> <span class="toc-text">起因</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%A6%96%E5%85%88%EF%BC%8C%E4%BB%8E%E5%93%AA%E9%87%8C%E8%8E%B7%E5%BE%97%E6%95%B0%E6%8D%AE%E5%91%A2%EF%BC%9F"><span class="toc-number">5.2.</span> <span class="toc-text">首先，从哪里获得数据呢？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%97%AE%E9%A2%98%E5%87%BA%E7%8E%B0"><span class="toc-number">5.3.</span> <span class="toc-text">问题出现</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B0%9D%E8%AF%95%E8%A7%A3%E5%86%B3"><span class="toc-number">5.4.</span> <span class="toc-text">尝试解决</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E6%8E%92%E6%9F%A5"><span class="toc-number">5.5.</span> <span class="toc-text">开始排查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">5.6.</span> <span class="toc-text">解决方案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%88%91%E6%98%AF%E7%A4%BA%E4%BE%8B"><span class="toc-number">5.7.</span> <span class="toc-text">我是示例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E8%8E%B7%E5%8F%96"><span class="toc-number">5.7.1.</span> <span class="toc-text">数据获取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97"><span class="toc-number">5.7.2.</span> <span class="toc-text">数据清洗</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E5%A7%8B%E5%88%86%E6%9E%90"><span class="toc-number">5.8.</span> <span class="toc-text">开始分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-1"><span class="toc-number">5.9.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">6.</span> <span class="toc-text">后记</span></a></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://blog.harumonia.moe/2020-01-13-spider-review-3-splash/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="harumonia"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Zaxon"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">python爬虫复习(3) splash &amp;&amp; 数据分析小试</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span><time title="创建时间：2020-01-13 22:19:59" itemprop="dateCreated datePublished" datetime="2020-01-13T22:19:59+00:00">2020-01-13</time></div><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon" style="margin-right:3px"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%BA%90%E6%B5%81%E6%B8%85%E6%B3%89/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">源流清泉</span></a></span> > <span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%BA%90%E6%B5%81%E6%B8%85%E6%B3%89/Python/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">Python</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/spider/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">spider</span></a></span></div><div class="post-author"><span class="author-name">harumonia</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7"><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><p>根据笔者以往的爬虫经验，大部分的爬虫是在静态网页上完成的，爬虫所要做的只不过是提交请求，然后分析返回的页面即可。当然，api 本质上也可以作为静态页面来处理。这意味着只要掌握 requests 就可以完成 60%-80%的爬虫任务。</p><p>这是一个很惊人的占比，这里解释一下，静态页面可能听起来很 low，但是有着以加载速度更快、易于维护为核心的一系列优势，尤其是引入了 ajax 之后，实现了动态加载，通过更加频繁的前后端交互，使得用户的使用更加丝滑流畅。</p><p>但是总有一些网站是静态爬虫无法应付的。它们就是与 js 耦合度较高的，需要 js 进行渲染的页面，与上文所述的情况（前端只接收数据，而不用对数据进行计算层面的处理）不同，这类网站将部分的计算工作交托给前端，牺牲部分的用户体验来实现缓解服务器压力等一系列目的。</p><p>这就是剩下的 20%了。如何处理这些刺头呢？这就引出了本文的主角–splash。</p><a id="more"></a><h2 id="关于-splash"><a href="#关于-splash" class="headerlink" title="关于 splash"></a>关于 splash</h2><p>Splash 是一个针对 js 的渲染服务。它内置了一个浏览器和 http 接口。基于 Python3 和 Twisted 引擎。所以可以异步处理任务。</p><p>关于 splash，国内目前的大部分博客教程都停留于对官方文档的翻译，所以还是推荐有能力的直接看文档，毕竟还有一个时效性。</p><p><a target="_blank" rel="noopener" href="https://splash.readthedocs.io/en/stable/install.html#os-x-docker">官方文档</a></p><h2 id="安装-amp-amp-运行"><a href="#安装-amp-amp-运行" class="headerlink" title="安装 &amp;&amp; 运行"></a>安装 &amp;&amp; 运行</h2><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">docker pull scrapinghub/splash

docker run -p <span class="token number">8050</span>:8050 -p <span class="token number">5023</span>:5023 scrapinghub/splash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="一个简单的-splash-应用"><a href="#一个简单的-splash-应用" class="headerlink" title="一个简单的 splash 应用"></a>一个简单的 splash 应用</h2><p>抓取今日头条，对比渲染和没有渲染的效果</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> lxml <span class="token keyword">import</span> etree

url <span class="token operator">=</span> <span class="token string">'http://localhost:8050/render.html?url=https://www.toutiao.com&amp;timeout=30&amp;wait=0.5'</span>
<span class="token comment"># url = 'https://www.toutiao.com'</span>

response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>

tree <span class="token operator">=</span> etree<span class="token punctuation">.</span>HTML<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>

article_titles <span class="token operator">=</span> tree<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="title-box"]/a/text()'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>article_titles<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>[&#39;总书记来过我们家，脱贫了还要好好干&#39;, &#39;北京2020年初雪已进城！您那儿下起来了吗？&#39;, &#39;论萌娃写作业时，求生欲有多强：爸爸我给你鼓掌&#39;, &#39;秦平：弘扬黄河文化，凝聚追梦中国精神力量&#39;, &#39;苏莱曼尼之死，全世界到底在怕什么？&#39;, &#39;观景平台，“零距离”看飞机&#39;, &#39;浙江一企业保险箱被撬，120万现金仅被偷走27万！小偷：当时想起一句“名言”……&#39;, &#39;划重点2020双闰年 网友：鼠年要多上一个月的班&#39;, &#39;若美伊全面开战，中国将再获20年发展机遇期？&#39;]</code></pre><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>如果没有渲染，那么得到的结果就是一个空的数组，只有进行了 js 渲染才能得到我们想要的结果。</p><h2 id="开始玩耍吧"><a href="#开始玩耍吧" class="headerlink" title="开始玩耍吧~"></a>开始玩耍吧~</h2><h3 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h3><p>前几天看电视剧时一时兴起（好吧，这就是老年人），想分析一下近年来的中国电视剧发展趋势，加上正好某鲨想要学爬虫，于是就重操旧业，开启了一个新坑。</p><h3 id="首先，从哪里获得数据呢？"><a href="#首先，从哪里获得数据呢？" class="headerlink" title="首先，从哪里获得数据呢？"></a>首先，从哪里获得数据呢？</h3><p>将目标锁定到了豆瓣（好吧，从某种层面上来说我也算是豆瓣的老用户了，经常因为使用爬虫被封号的那种(笑)）。</p><p>具体点说，是豆瓣排行榜，在进行了网页分析之后，发现所有的数据都是通过 api 回传的，这感情好，直接上 requests 莽一波就完事了。</p><h3 id="问题出现"><a href="#问题出现" class="headerlink" title="问题出现"></a>问题出现</h3><p>爬完之后发现，豆瓣排行榜只放出了前 500 条数据，500 条能干啥哦？？？</p><h3 id="尝试解决"><a href="#尝试解决" class="headerlink" title="尝试解决"></a>尝试解决</h3><p>重新寻找，发现豆瓣的搜索功能可以一试。于是搜索关键词“1990+电视剧”，果然，1990 年的电视剧就都出来了。但是，分析了半天网页，没有发现什么 api？于是开始进行第二轮的地毯式分析，果然，在主页面的 html 文件里发现了一条又臭又长的数据“window.__DATA__”，里面存放了一大堆的诡异的字符串，这。。。。！？忽然想起来前几天看的密码学，不就是这个鲨雕样子吗，那么很大概率就是豆瓣对自己的数据进行了加密！</p><p><img src="https://i.loli.net/2020/01/13/CqSXPvtVJTDkrfw.png" alt="截屏2020-01-13下午9.52.44.png" loading="lazy"></p><h3 id="开始排查"><a href="#开始排查" class="headerlink" title="开始排查"></a>开始排查</h3><p>使用 url 过滤，配合二分法截断 url，再用 js 断点调试，最后在 bundle.js 文件里发现了解密过程。<br><img src="https://i.loli.net/2020/01/13/lPLvoERhY5k6UST.png" alt="截屏2020-01-13下午9.54.17.png" loading="lazy"></p><p>这时有两条路可以选择。</p><ul><li>解密</li><li>不解密</li></ul><p>于是又刷新了一下网页，“window.__DATA__”存放的数据变了。。。变了。。。好吧，竟然还采用了动态密钥，我解密个锤子哦？果断选择第二条路。</p><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>既然你用 js 渲染解密，那我就等你渲染完了再爬呗<del>~</del></p><h3 id="我是示例"><a href="#我是示例" class="headerlink" title="我是示例"></a>我是示例</h3><h4 id="数据获取"><a href="#数据获取" class="headerlink" title="数据获取"></a>数据获取</h4><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">from</span> urllib<span class="token punctuation">.</span>parse <span class="token keyword">import</span> quote
<span class="token keyword">import</span> json
<span class="token keyword">import</span> time
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd

<span class="token comment"># 初始化Dataframe</span>
df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 记录序号</span>
index <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">def</span> <span class="token function">get_soup</span><span class="token punctuation">(</span>url_raw<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    @description: 获取指定url的数据并将其解析为soup
    @param &#123;type&#125;
        url_raw &#123;string&#125;
    @return: BeautifulSoup的解析结果
    '''</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token comment">## lua脚本</span>
        lua <span class="token operator">=</span> <span class="token triple-quoted-string string">'''
        function main(splash, args)
          assert(splash:go("'''</span><span class="token operator">+</span>url_raw<span class="token operator">+</span><span class="token triple-quoted-string string">'''"))
          return &#123;
            html = splash:html(),
            png = splash:png(),
            har = splash:har(),
          &#125;
        end
        '''</span>
        url <span class="token operator">=</span> <span class="token string">'http://localhost:8050/execute?lua_source='</span> <span class="token operator">+</span> quote<span class="token punctuation">(</span>lua<span class="token punctuation">)</span>
        response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        js <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>js<span class="token punctuation">[</span><span class="token string">'html'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> soup

    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">html_parser</span><span class="token punctuation">(</span>soup<span class="token punctuation">,</span>year<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">'''
    @description: 解析网页，提取结果
    @param &#123;type&#125;
        soup &#123;BeautifulSoup&#125; 解析完成的soup
        year &#123;int&#125; 第几年
    @return:
    '''</span>
    tv_detail <span class="token operator">=</span> <span class="token punctuation">[</span>foo <span class="token keyword">for</span> foo <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'item-root'</span><span class="token punctuation">)</span> <span class="token keyword">if</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'.*'</span><span class="token operator">+</span><span class="token builtin">str</span><span class="token punctuation">(</span>year<span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'.*'</span><span class="token punctuation">,</span>foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'title-text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> foo <span class="token keyword">in</span> tv_detail<span class="token punctuation">:</span>
        index<span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">if</span> foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'rating_nums'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'year'</span><span class="token punctuation">]</span> <span class="token operator">=</span> year
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'rating_nums'</span><span class="token punctuation">]</span> <span class="token operator">=</span> foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'rating_nums'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'rating_people'</span><span class="token punctuation">]</span> <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'\D*(\d*)\D*'</span><span class="token punctuation">,</span>foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'pl'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'title'</span><span class="token punctuation">]</span> <span class="token operator">=</span> foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'title-text'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
            split_res <span class="token operator">=</span> foo<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'meta abstract'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token operator">=</span> split_res<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'tv_type'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">[</span>foo <span class="token keyword">for</span> foo <span class="token keyword">in</span> split_res<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> year <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1991</span><span class="token punctuation">,</span><span class="token number">2019</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># url后缀参数</span>
    start_num <span class="token operator">=</span> <span class="token number">0</span>

    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        url_raw_1 <span class="token operator">=</span> <span class="token string">"https://search.douban.com/movie/subject_search?search_text=&#123;&#125;+电视剧&amp;start=&#123;&#125;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span>start_num<span class="token operator">*</span><span class="token number">15</span><span class="token punctuation">)</span>
        soup <span class="token operator">=</span> get_soup<span class="token punctuation">(</span>url_raw_1<span class="token punctuation">)</span>
        html_parser<span class="token punctuation">(</span>soup<span class="token punctuation">,</span>year<span class="token punctuation">)</span>
        <span class="token comment"># 判断是否存在后续页（若无，则该年结束，继续下一年的爬取）</span>
        <span class="token keyword">if</span> <span class="token keyword">not</span> soup<span class="token punctuation">.</span>find<span class="token punctuation">(</span>class_<span class="token operator">=</span><span class="token string">'next activate'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            start_num<span class="token operator">+=</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 这一过程耗时较长，为了防止意外导致数据丢失，所以每一年的爬取完成之后，保存结果</span>
            df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span><span class="token string">'tv_data_1990_2018.csv'</span><span class="token punctuation">)</span>
            <span class="token keyword">break</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">df<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre><code>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 7426 entries, 3 to 8817
Data columns (total 6 columns):
year             7426 non-null float64
rating_nums      7426 non-null object
rating_people    7426 non-null object
title            7426 non-null object
country          7426 non-null object
tv_type          7426 non-null object
dtypes: float64(1), object(5)
memory usage: 726.1+ KB</code></pre><p>嗯，1990 年-2018 年一共获取了 7426 条数据，似乎没啥问题。</p><p>开始进行数据清洗吧。</p><h4 id="数据清洗"><a href="#数据清洗" class="headerlink" title="数据清洗"></a>数据清洗</h4><ul><li>由于之前的序号不是严格顺序的（因为各种因素出现序号断层），我们将数据重新排序，并且指定新的序号（强迫症了）。</li><li>在上面的 info 表中，可以发现，rating_nums 和 rating_people 两项，我希望它是 float 类型的。</li><li>部分国家的电视剧数量太少，由于现在主要的分析目标是中国电视剧发展趋势，所以将 30 年来电视剧统计量小于 100 的剔除掉</li></ul><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> seaborn <span class="token keyword">as</span> sns
<span class="token keyword">from</span> collections <span class="token keyword">import</span> Counter
<span class="token keyword">import</span> re<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">dfnew <span class="token operator">=</span> df<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

dfnew<span class="token punctuation">[</span><span class="token string">'rating_nums'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dfnew<span class="token punctuation">[</span><span class="token string">'rating_nums'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span>
dfnew<span class="token punctuation">[</span><span class="token string">'rating_people'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dfnew<span class="token punctuation">[</span><span class="token string">'rating_people'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>
dfnew<span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">]</span> <span class="token operator">=</span> dfnew<span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span>

countries <span class="token operator">=</span> <span class="token punctuation">[</span>k <span class="token keyword">for</span> k<span class="token punctuation">,</span>v <span class="token keyword">in</span> Counter<span class="token punctuation">(</span>df<span class="token punctuation">.</span>country<span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> v <span class="token operator">></span> <span class="token number">300</span><span class="token punctuation">]</span>
df_final <span class="token operator">=</span> dfnew<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>index<span class="token operator">=</span><span class="token punctuation">[</span>index <span class="token keyword">for</span> index <span class="token keyword">in</span> dfnew<span class="token punctuation">.</span>index <span class="token keyword">if</span> dfnew<span class="token punctuation">.</span>loc<span class="token punctuation">[</span>index<span class="token punctuation">,</span><span class="token string">'country'</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> countries<span class="token punctuation">]</span><span class="token punctuation">)</span>
df_final <span class="token operator">=</span> df_final<span class="token punctuation">.</span>sort_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reset_index<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>drop<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'index'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
df_final<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}</style><p></p><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>rating_nums</th><th>rating_people</th><th>title</th><th>country</th><th>tv_type</th></tr></thead><tbody><tr><th>0</th><td>1991</td><td>9.4</td><td>101919</td><td>东京爱情故事 東京ラブストーリー‎ (1991)</td><td>日本</td><td>爱情</td></tr><tr><th>1</th><td>1991</td><td>9.6</td><td>4490</td><td>成长的烦恼 第七季 Growing Pains Season 7‎ (1991)</td><td>美国</td><td>喜剧,家庭</td></tr><tr><th>2</th><td>1991</td><td>9.2</td><td>1509</td><td>宋飞正传 第三季 Seinfeld Season 3‎ (1991)</td><td>美国</td><td>喜剧</td></tr><tr><th>3</th><td>1991</td><td>7.4</td><td>4598</td><td>外来妹‎ (1991)</td><td>中国大陆</td><td>剧情,爱情</td></tr><tr><th>4</th><td>1991</td><td>8.9</td><td>2140</td><td>宋飞正传 第二季 Seinfeld Season 2‎ (1991)</td><td>美国</td><td>喜剧</td></tr></tbody></table></div><h3 id="开始分析"><a href="#开始分析" class="headerlink" title="开始分析"></a>开始分析</h3><pre class="line-numbers language-python" data-language="python"><code class="language-python">df_year_rate <span class="token operator">=</span> df_final<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'rating_nums'</span><span class="token punctuation">,</span><span class="token string">'year'</span><span class="token punctuation">,</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>groupby<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'year'</span><span class="token punctuation">,</span><span class="token string">'country'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>as_index<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">.</span>aggregate<span class="token punctuation">(</span>np<span class="token punctuation">.</span>average<span class="token punctuation">)</span>
df_year_rate<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}</style><p></p><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>year</th><th>country</th><th>rating_nums</th></tr></thead><tbody><tr><th>0</th><td>1990</td><td>美国</td><td>9.600000</td></tr><tr><th>1</th><td>1991</td><td>中国大陆</td><td>6.966667</td></tr><tr><th>2</th><td>1991</td><td>中国香港</td><td>7.388889</td></tr><tr><th>3</th><td>1991</td><td>日本</td><td>8.400000</td></tr><tr><th>4</th><td>1991</td><td>美国</td><td>8.771429</td></tr></tbody></table></div><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>lineplot<span class="token punctuation">(</span>x<span class="token operator">=</span>df_year_rate<span class="token punctuation">.</span>year<span class="token punctuation">,</span>y<span class="token operator">=</span>df_year_rate<span class="token punctuation">.</span>rating_nums<span class="token punctuation">,</span>hue<span class="token operator">=</span>df_year_rate<span class="token punctuation">.</span>country<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xticks<span class="token punctuation">(</span>rotation<span class="token operator">=</span><span class="token number">90</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><pre><code>(array([1985., 1990., 1995., 2000., 2005., 2010., 2015., 2020.]),
 &lt;a list of 8 Text xticklabel objects&gt;)</code></pre><p><img src="https://i.loli.net/2020/01/13/rTLHkQO4gmvX5yf.png" alt="output_11_1.png" loading="lazy"></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">ten_year_type_count</span><span class="token punctuation">(</span>dften<span class="token punctuation">)</span><span class="token punctuation">:</span>
    s1<span class="token operator">=</span> <span class="token string">','</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>dften<span class="token punctuation">.</span>tv_type<span class="token punctuation">)</span>
    all_type <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">r',+'</span><span class="token punctuation">,</span><span class="token string">','</span><span class="token punctuation">,</span>s1<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>foo <span class="token keyword">for</span> foo <span class="token keyword">in</span> <span class="token builtin">sorted</span><span class="token punctuation">(</span>Counter<span class="token punctuation">(</span>all_type<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>key<span class="token operator">=</span><span class="token keyword">lambda</span> item<span class="token punctuation">:</span>item<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>reverse<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token keyword">if</span> foo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">5</span><span class="token punctuation">]</span>


five_list <span class="token operator">=</span> <span class="token punctuation">[</span>ten_year_type_count<span class="token punctuation">(</span>df_final<span class="token punctuation">[</span>df_final<span class="token punctuation">.</span>country<span class="token operator">==</span><span class="token string">"中国大陆"</span><span class="token punctuation">]</span><span class="token punctuation">[</span>df_final<span class="token punctuation">.</span>year<span class="token operator">&lt;=</span>foo<span class="token punctuation">]</span><span class="token punctuation">[</span>df_final<span class="token punctuation">.</span>year<span class="token operator">></span>foo<span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> foo <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1994</span><span class="token punctuation">,</span><span class="token number">2021</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">type_list <span class="token operator">=</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token punctuation">[</span>foo1<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> foo <span class="token keyword">in</span> five_list <span class="token keyword">for</span> foo1 <span class="token keyword">in</span> foo<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
df_five_type <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>index <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1994</span><span class="token punctuation">,</span><span class="token number">1998</span><span class="token punctuation">,</span><span class="token number">2002</span><span class="token punctuation">,</span><span class="token number">2006</span><span class="token punctuation">,</span><span class="token number">2010</span><span class="token punctuation">,</span><span class="token number">2014</span><span class="token punctuation">,</span><span class="token number">2018</span><span class="token punctuation">]</span><span class="token punctuation">,</span>columns<span class="token operator">=</span>type_list<span class="token punctuation">,</span>data<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> index<span class="token punctuation">,</span>five <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>five_list<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> foo <span class="token keyword">in</span> five<span class="token punctuation">:</span>
        df_five_type<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token number">1994</span><span class="token operator">+</span>index<span class="token operator">*</span><span class="token number">4</span><span class="token punctuation">,</span>foo<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> foo<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
df_five_type<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}</style><p></p><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>古装</th><th>儿童</th><th>传记</th><th>家庭</th><th>历史</th><th>动作</th><th>惊悚</th><th>剧情</th><th>战争</th><th>悬疑</th><th>爱情</th><th>奇幻</th><th>科幻</th><th>喜剧</th><th>犯罪</th><th>武侠</th></tr></thead><tbody><tr><th>1994</th><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>13</td><td>0</td><td>0</td><td>0</td><td>0</td><td>0</td><td>7</td><td>0</td><td>0</td></tr><tr><th>1998</th><td>0</td><td>0</td><td>0</td><td>0</td><td>7</td><td>0</td><td>0</td><td>39</td><td>0</td><td>0</td><td>12</td><td>0</td><td>0</td><td>7</td><td>0</td><td>0</td></tr><tr><th>2002</th><td>26</td><td>0</td><td>0</td><td>7</td><td>16</td><td>0</td><td>0</td><td>81</td><td>0</td><td>0</td><td>17</td><td>0</td><td>0</td><td>10</td><td>10</td><td>9</td></tr><tr><th>2006</th><td>30</td><td>0</td><td>0</td><td>13</td><td>9</td><td>8</td><td>0</td><td>105</td><td>9</td><td>6</td><td>30</td><td>0</td><td>0</td><td>25</td><td>6</td><td>0</td></tr><tr><th>2010</th><td>12</td><td>7</td><td>0</td><td>34</td><td>11</td><td>12</td><td>0</td><td>164</td><td>20</td><td>13</td><td>40</td><td>6</td><td>0</td><td>21</td><td>9</td><td>0</td></tr><tr><th>2014</th><td>48</td><td>6</td><td>16</td><td>108</td><td>44</td><td>19</td><td>0</td><td>384</td><td>82</td><td>26</td><td>181</td><td>11</td><td>6</td><td>85</td><td>13</td><td>9</td></tr><tr><th>2018</th><td>74</td><td>7</td><td>0</td><td>58</td><td>11</td><td>20</td><td>8</td><td>440</td><td>52</td><td>66</td><td>182</td><td>50</td><td>9</td><td>78</td><td>30</td><td>11</td></tr></tbody></table></div><pre class="line-numbers language-python" data-language="python"><code class="language-python">plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sns<span class="token punctuation">.</span>heatmap<span class="token punctuation">(</span>data<span class="token operator">=</span>df_five_type<span class="token punctuation">,</span> annot<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> fmt<span class="token operator">=</span><span class="token string">"d"</span><span class="token punctuation">,</span> linewidths<span class="token operator">=</span><span class="token number">.5</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><pre><code>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1a2ffe5be0&gt;</code></pre><p><img src="https://i.loli.net/2020/01/13/NAVtujdBlREgF5M.png" alt="output_14_1.png" loading="lazy"></p><h3 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h3><p>大概地总结一下吧，这里一定程度上真实地反映了人们观念的变化对电视剧市场造成的自然选择以及历史的必然趋势。</p><p>之所以说是历史的趋势，可以看到，随着时间的增长，剧种、剧目数量，都呈现上升的趋势，这是由于经济基础的建设，人民满足了基本的物质需求，继而开始追求精神需求的体现。</p><p>10 年以前，战争剧稀少，诸如《亮剑》、《团长》等优质的抗战剧大多诞生于这个时期。10 年以后，由于政策的扶持和被优质片打开的市场，战争题材的电视剧开始出现井喷，说好听点良莠不齐，说难听点，一堆杂草群魔乱舞，诸多的“神剧”就是这之后的产物。</p><p>家庭、爱情剧方面，这一部分我看的较少，不过大概也是可以分析一下。14 年以前，受韩剧市场大成功的影响，加上题材容易量产，所以得到了资本的大量倾注，诸如《回家的诱惑》等剧就是这个时间段的产物。而 14 年以后，市场由“家庭”偏向“爱情”，主要是因为市场的主力军变了，新生代的大学生开始成为左右这一部分市场的中坚力量，自然市场就要向着迎合这一部分人群的方向发展。</p><p>古装剧涨势良好，以往（14 年以前）的古装剧，多以正剧、武侠剧为主(但是因为武侠又以香港地区为主，所以该表显示的武侠剧并没有大家印象中的那么多)，而 14 年以后，以于正为首的抄袭派作家找到了量产古装剧的套路，同时，古装剧在“造星”方面有着天然的优势，所以古装剧在近几年发展迅速，尤以“古装+爱情”这样的组合见多。</p><p>好吧，暂时就先分析这么多吧，更多的就留着以后有闲工夫了，再做探究。</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><ul><li>为了这一章特地看了一点 lua</li><li>相见时难别亦难</li></ul><p>再次踏上故乡的土地，这一年里经历良多，以至有物是人非之感。<br>这一年，辗转各地参加比赛，看到了很多优秀的作品，认识到很多优秀的人，我开始逐渐明白，以前老顾常说的，“这只是一个小地方”，没错，投诸广袤的华夏大地，这片土地只是十分渺小的、不起眼的一点，而我，从小到大所以受到的良多赞誉，也只限于这一点罢了，出了这一点，方知过往的种种妄语，实在是井底之言。<br>又想起了初中时读《博弈论》，“凡有所失必有所得”，少时懵懂，不解其意，及至今日，这句话却又忽的涌上心头，我失去了什么？又得到了什么？果然，有些事物，越是成长，越是深刻。<br>所有的念头起于刹那又终于刹那，周身是人潮涌动，他们都去往同一个方向，归乡的人们，大多脸上洋溢着希望与喜悦。<br>我提起行囊，汇入人海，这一刻，我是沧海的一粟，也是历史的洪流。我是构成这个庞大的名为国家的机器的一个小小的齿轮，也许被替代，但是却无法被复制。<br>带着这样的觉悟，我向前走去。</p><p>– 2020 年 01 月 13 日，写于夜深人静之时。</p></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none"><div style="display:inline-block"></div><div style="display:inline-block"></div><div style="display:inline-block"></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>harumonia</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://blog.harumonia.moe/2020-01-13-spider-review-3-splash/" title="python爬虫复习(3) splash &amp;&amp; 数据分析小试">https://blog.harumonia.moe/2020-01-13-spider-review-3-splash/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a>许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020-01-17-Linux-cmd-review/" rel="prev" title="Linux常用命令复习1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">Linux常用命令复习1</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020-01-08-spider-review-2-Improve-efficiency/" rel="next" title="python爬虫复习(2) 提高效率"><span class="post-nav-text">python爬虫复习(2) 提高效率</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"r4JnhWDHnAkpVuaNKYAjM4rG-MdYXbMMI","appKey":"V82g09a4cwRrbvD1eTpo6SVt","placeholder":"Just go go","avatar":null,"meta":["nick","mail","link"],"pageSize":10,"visitor":false,"highlight":true,"recordIP":true,"enableQQ":true,"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/2020-01-13-spider-review-3-splash/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2019 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author">harumonia</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v5.1.1</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.6.1</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>