<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="theme-color" content="#0078E7"><meta name="author" content="harumonia"><meta name="copyright" content="harumonia"><meta name="generator" content="Hexo 5.1.1"><meta name="theme" content="hexo-theme-yun"><title>redis学习笔记(2) | Zaxon</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_j5gk85dg4pf.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>document.addEventListener("DOMContentLoaded", () => {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
});</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme:light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme:dark)"><link rel="icon" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="alternate icon" href="/yun.ico"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"blog.harumonia.moe","root":"/","title":"Zaxon-迷雾中的藏宝地","version":"1.6.1","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};</script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><link rel="preconnect" href="https://www.google-analytics.com" crossorigin><script async src="https://www.googletagmanager.com/gtag/js?id=G-EBNGE3F0F6"></script><script>function gtag(){dataLayer.push(arguments)}CONFIG.hostname===location.hostname&&(window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-EBNGE3F0F6"))</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><meta name="description" content="3 进阶功能3.1 慢查询"><meta property="og:type" content="article"><meta property="og:title" content="redis学习笔记(2)"><meta property="og:url" content="https://blog.harumonia.moe/2020-02-12-redis-note-2/index.html"><meta property="og:site_name" content="Zaxon"><meta property="og:description" content="3 进阶功能3.1 慢查询"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://typora-zxj.oss-cn-beijing.aliyuncs.com/typora/20200212121243-387827.png"><meta property="og:image" content="http://typora-zxj.oss-cn-beijing.aliyuncs.com/typora/20200212121019-469340.png"><meta property="article:published_time" content="2020-02-12T12:15:00.000Z"><meta property="article:modified_time" content="2020-02-15T14:02:15.000Z"><meta property="article:author" content="harumonia"><meta property="article:tag" content="redis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://typora-zxj.oss-cn-beijing.aliyuncs.com/typora/20200212121243-387827.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="harumonia"><img width="96" loading="lazy" src="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/Ocabe.webp" alt="harumonia"></a><div class="site-author-name"><a href="/about/">harumonia</a></div><span class="site-name">Zaxon</span><sub class="site-subtitle">Find the key of soul</sub><div class="site-desciption">lazy</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">118</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">15</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">62</span></a></div><a class="site-state-item hty-icon-button" href="/books" title="读书"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-book-2-line"></use></svg></span></a></nav><hr style="margin-bottom:.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" href="/atom.xml" title="RSS" target="_blank" style="color:orange"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-rss-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://qm.qq.com/cgi-bin/qm/qr?k=DSmoEtSKHITcV9pghYqqmSQ80-SPnPjm&amp;noverify=0" title="QQ" target="_blank" style="color:#12b7f5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://github.com/zxjlm" title="GitHub" target="_blank" style="color:#6e5494"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-github-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://www.douban.com/people/Zxj_Butterfly_m/" title="豆瓣" target="_blank" style="color:#072"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-douban-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://music.163.com/#/user/home?id=305617499" title="网易云音乐" target="_blank" style="color:#c20c0c"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-netease-cloud-music-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://space.bilibili.com/1801214" title="哔哩哔哩" target="_blank" style="color:#ff8eb3"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-bilibili-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="https://twitter.com/Harumonia1996" title="Twitter" target="_blank" style="color:#1da1f2"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-twitter-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" href="mailto:zxjlm233@gmail.com" title="E-Mail" target="_blank" style="color:#8e71c1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><hr style="margin:.5rem 1rem"><div class="links"><a class="links-item hty-icon-button" href="/links/" title="我的小伙伴们" style="color:#1e90ff"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-genderless-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color:#f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E8%BF%9B%E9%98%B6%E5%8A%9F%E8%83%BD"><span class="toc-number">1.</span> <span class="toc-text">3 进阶功能</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-%E6%85%A2%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.1.</span> <span class="toc-text">3.1 慢查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%B4%E6%98%8E"><span class="toc-number">1.1.1.</span> <span class="toc-text">说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE"><span class="toc-number">1.1.2.</span> <span class="toc-text">配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4"><span class="toc-number">1.1.3.</span> <span class="toc-text">命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tips"><span class="toc-number">1.1.3.1.</span> <span class="toc-text">tips</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-pipeline"><span class="toc-number">1.2.</span> <span class="toc-text">3.2 pipeline</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#tips-1"><span class="toc-number">1.2.0.1.</span> <span class="toc-text">tips</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%B9%E6%AF%94"><span class="toc-number">1.2.1.</span> <span class="toc-text">对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85"><span class="toc-number">1.3.</span> <span class="toc-text">3.3 发布订阅</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4"><span class="toc-number">1.3.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8"><span class="toc-number">1.3.2.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-1"><span class="toc-number">1.3.3.</span> <span class="toc-text">常用命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-bitmap"><span class="toc-number">1.4.</span> <span class="toc-text">3.4 bitmap</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%EF%BC%9A"><span class="toc-number">1.4.1.</span> <span class="toc-text">应用：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%B8%80%EF%BC%9A%E7%94%A8-set-%E6%9D%A5%E4%BF%9D%E5%AD%98"><span class="toc-number">1.4.1.1.</span> <span class="toc-text">方式一：用 set 来保存</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E5%BC%8F%E4%BA%8C%EF%BC%9A%E4%BD%BF%E7%94%A8-bitmap-%E7%9A%84%E6%96%B9%E5%BC%8F"><span class="toc-number">1.4.1.2.</span> <span class="toc-text">方式二：使用 bitmap 的方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85"><span class="toc-number">1.4.2.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-HyperLogLog"><span class="toc-number">1.5.</span> <span class="toc-text">3.5 HyperLogLog</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4-1"><span class="toc-number">1.5.0.1.</span> <span class="toc-text">命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%BC%94%E7%A4%BA"><span class="toc-number">1.5.1.</span> <span class="toc-text">命令演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-1"><span class="toc-number">1.5.2.</span> <span class="toc-text">补充</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-GEO-geospatial"><span class="toc-number">1.6.</span> <span class="toc-text">3.6 GEO(geospatial)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4-2"><span class="toc-number">1.6.1.</span> <span class="toc-text">常用命令</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%BC%94%E7%A4%BA-1"><span class="toc-number">1.6.2.</span> <span class="toc-text">命令演示</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BA%94%E7%94%A8-1"><span class="toc-number">1.6.3.</span> <span class="toc-text">应用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A5%E5%85%85-2"><span class="toc-number">1.6.4.</span> <span class="toc-text">补充</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E8%AE%B0"><span class="toc-number">1.7.</span> <span class="toc-text">后记</span></a></li></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="https://blog.harumonia.moe/2020-02-12-redis-note-2/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="harumonia"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Zaxon"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">redis学习笔记(2)</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span><time title="创建时间：2020-02-12 12:15:00" itemprop="dateCreated datePublished" datetime="2020-02-12T12:15:00+00:00">2020-02-12</time><span class="post-meta-divider">-</span><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-2-line"></use></svg></span><time title="修改时间：2020-02-15 14:02:15" itemprop="dateModified" datetime="2020-02-15T14:02:15+00:00">2020-02-15</time></div><span class="leancloud_visitors" id="/2020-02-12-redis-note-2/" data-flag-title="redis学习笔记(2)"><span class="post-meta-divider">-</span><span class="post-meta-item-icon" title="阅读次数"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-eye-line"></use></svg> <span class="leancloud-visitors-count"></span></span></span><div class="post-classify"><span class="post-category"><span class="post-meta-item-icon" style="margin-right:3px"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/%E6%BA%90%E6%B5%81%E6%B8%85%E6%B3%89/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">源流清泉</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/redis/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">redis</span></a></span></div><div class="post-author"><span class="author-name">harumonia</span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7"><h1 id="3-进阶功能"><a href="#3-进阶功能" class="headerlink" title="3 进阶功能"></a>3 进阶功能</h1><h2 id="3-1-慢查询"><a href="#3-1-慢查询" class="headerlink" title="3.1 慢查询"></a>3.1 慢查询</h2><p><img src="http://typora-zxj.oss-cn-beijing.aliyuncs.com/typora/20200212121243-387827.png" alt="image-20200212121241917" loading="lazy"></p><a id="more"></a><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><ul><li>慢查询发生在第 3 阶段（执行命令阶段）</li><li>客户端超时不一定慢查询，但慢查询是客户端超时的一个可能</li></ul><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><ol><li><p>slowlog-man-len</p><ol><li>先进先出队列</li><li>固定长度</li><li>保存在内存内，即，随重启而重置</li></ol></li><li><p>slowlog-log-slower-than</p><ol><li>慢查询阈值（微秒）</li><li>slowlog-log-slower-than = 0 ， 记录所有命令</li><li>slowlog-log-slower-than &lt; 0, 不记录任何命令</li></ol></li></ol><p>配置方法</p><ol><li>默认值<ol><li>config get slowlog-man-len = 128</li><li>config slowlog-log-slower-than = 10000</li></ol></li><li>修改配置文件重启<ul><li>一旦 Redis 运行之后，不建议进行重启操作</li></ul></li><li>动态配置<ol><li>config get slowlog-man-len value</li><li>config slowlog-log-slower-than value</li></ol></li></ol><h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h3><ul><li>slowlog get [n] 获取慢查询队列</li><li>slowlog len 获取慢查询队列长度</li><li>slowlog reset 清空慢查询队列</li></ul><h4 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h4><ol><li>slowlog-man-len 不要设置过大。默认 10ms，通常设置 1ms</li><li>slowlog-log-slower-than 不要设置过小，通常设置 1000</li><li>理解生命周期</li><li>定期持久化查询</li></ol><h2 id="3-2-pipeline"><a href="#3-2-pipeline" class="headerlink" title="3.2 pipeline"></a>3.2 pipeline</h2><p>通常情况下，执行一条命令就需要一次客户端和服务端的交互。而 redis 的命令时间是微秒级别的，那么提高 redis 的执行效率的一个主要方向就是减少服务器与客户端的交互频率。</p><p>pipeline 的功能就是将一组命令打包并发送到服务器，在服务器依次执行之后，再将结果打包返回给客户端，这样一来客户端与服务端就只需要交互一次，在涉及大量交互的情境下无疑十分地便利。</p><h4 id="tips-1"><a href="#tips-1" class="headerlink" title="tips"></a>tips</h4><ol><li>注意每次使用 pipeline 的数据携带量</li><li>一个 redis 服务器一次只能运行一条 pipeline</li></ol><h3 id="对比"><a href="#对比" class="headerlink" title="对比"></a>对比</h3><p>这里我使用 python 对 redis 做了小实验。写入 100000 条数据的情况下，使用 pipeline 和不适用 pipeline 的耗时对比。</p><blockquote><p>补充说明，这里使用了远程的 redis 服务器，更好地体现出交互过程在整个 redis 数据库操作中所占的时间比重。</p></blockquote><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">try_pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">with</span> client<span class="token punctuation">.</span>pipeline<span class="token punctuation">(</span>transaction<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
        <span class="token keyword">for</span> foo <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            key <span class="token operator">=</span> <span class="token string">'uuid_&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
            p<span class="token punctuation">.</span>pfadd<span class="token punctuation">(</span>key<span class="token punctuation">,</span>foo<span class="token punctuation">)</span>
        p<span class="token punctuation">.</span>execute<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">without_pipeline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    start <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> foo <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        key <span class="token operator">=</span> <span class="token string">'uuid_&#123;&#125;'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span>
        client<span class="token punctuation">.</span>pfadd<span class="token punctuation">(</span>key<span class="token punctuation">,</span>foo<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> start<span class="token punctuation">)</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输出结果如下</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">try_pipeline <span class="token builtin class-name">:</span> <span class="token number">2.6968681812286377</span>
without_pipeline <span class="token builtin class-name">:</span> <span class="token number">3320.136715888977</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="3-3-发布订阅"><a href="#3-3-发布订阅" class="headerlink" title="3.3 发布订阅"></a>3.3 发布订阅</h2><p>Redis 发布订阅(pub/sub)是一种消息通信模式：发送者(pub)发送消息，订阅者(sub)接收消息。</p><p>Redis 客户端可以订阅任意数量的频道。</p><p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p><p><img src="http://typora-zxj.oss-cn-beijing.aliyuncs.com/typora/20200212121019-469340.png" alt="p21" loading="lazy"></p><blockquote><p>类比生产者-消费者模型进行理解。发送者对应生产者，订阅者对应消费者。</p></blockquote><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li>subscribe channel 进行订阅监听</li><li>unsubscribe channel 解除订阅</li><li>publish channel message 进行发布消息广播</li></ul><h3 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h3><p>顾名思义，发布订阅的一个典型的应用场景就是实现自动更新的<code>订阅</code>功能(类比于门户网站的<strong>关注</strong>功能)。</p><p>还有一个应用场景就是实时聊天系统。</p><blockquote><p>个人(redis 初学者)感觉 redis 的订阅功能很粗糙，如果追求更加细致的发布订阅动能可以考虑诸如<strong>ActiveMQ</strong>等。</p></blockquote><p>通过一个 bit 位来表示某个元素对应的值或者状态,其中的 key 就是对应元素本身。Bitmaps 本身不是一种数据结构，实际上它就是字符串（key 对应的 value 就是上图中最后的一串二进制），但是它可以对字符串的位进行操作。 Bitmaps 单独提供了一套命令，所以在 Redis 中使用 Bitmaps 和使用字符串的方法不太相同。可以把 Bitmaps 想象成一个以 位 为单位的数组，数组的每个单元只能存储 0 和 1，数组的下标在 Bitmaps 中叫做偏移量。</p><blockquote><p>如，zxj 这个字符串</p><p>z 对应的二进制值为 01111010</p><p>x 对应的二进制值为 01111000</p><p>j 对应的二进制值为 01101010</p></blockquote><h3 id="常用命令-1"><a href="#常用命令-1" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><p>GETBIT key offset 获取字符串值指定偏移量上的位(bit)</p></li><li><p>SETBIT key offset value 对 key 所储存的字符串值，设置或清除指定偏移量上的位(bit)。</p></li><li><p>BITCOUNT key [start end] 计算给定字符串中，被设置为 <code>1</code> 的比特位的数量</p></li><li><p>bitop op dtstkey key [key…] 做多个 bitmap 的 and(交集),or(并集),not(非),xor(异或)操作并将结果保存在 destkey 中</p><ul><li><pre><code>bitpos key targetBit [start] [end]  计算位图指定范围(start到end,单位为字节，如果不指定就是获取全部)第一个偏移量对应的值等于targetBit的位置
<pre class="line-numbers language-none"><code class="language-none">
&#96;&#96;&#96;bash
127.0.0.1:6379[1]&gt; set zxj zxj2333
OK
127.0.0.1:6379[1]&gt; GETBIT zxj 1
(integer) 1
127.0.0.1:6379[1]&gt; SETBIT zxj 1 0
(integer) 1
127.0.0.1:6379[1]&gt; get zxj
&quot;:xj2333&quot;
127.0.0.1:6379[1]&gt; BITCOUNT zxj
(integer) 27

127.0.0.1:6379[1]&gt; set tt tt
OK
127.0.0.1:6379[1]&gt; BITOP and zxj tt
(integer) 2
127.0.0.1:6379[1]&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
</code></pre></li></ul></li></ul><h2 id="3-4-bitmap"><a href="#3-4-bitmap" class="headerlink" title="3.4 bitmap"></a>3.4 bitmap</h2><h3 id="应用："><a href="#应用：" class="headerlink" title="应用："></a>应用：</h3><p>参考自<a target="_blank" rel="noopener" href="https://blog.csdn.net/lglgsy456/article/details/39394961">redis 用 setbit(bitmap)统计活跃用户</a></p><p>如果一个网站有 1 亿用户，假如 user_id 用的是整型，长度为 32 位，每天有 5 千万独立用户访问，如何判断是哪 5 千万用户访问了网站</p><h4 id="方式一：用-set-来保存"><a href="#方式一：用-set-来保存" class="headerlink" title="方式一：用 set 来保存"></a>方式一：用 set 来保存</h4><p>使用 set 来保存数据运行一天需要占用的内存为</p><pre class="line-numbers language-none"><code class="language-none">32bit * 50000000 &#x3D; (4 * 50000000) &#x2F; 1024 &#x2F;1024 MB，约为200MB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行一个月需要占用的内存为 6G，运行一年占用的内存为 72G</p><pre class="line-numbers language-none"><code class="language-none">30 * 200 &#x3D; 6G<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="方式二：使用-bitmap-的方式"><a href="#方式二：使用-bitmap-的方式" class="headerlink" title="方式二：使用 bitmap 的方式"></a>方式二：使用 bitmap 的方式</h4><p>如果 user_id 访问网站，则在 user_id 的索引上设置为 1，没有访问网站的 user_id，其索引设置为 0，此种方式运行一天占用的内存为</p><pre class="line-numbers language-none"><code class="language-none">1 * 100000000 &#x3D; 100000000 &#x2F; 1024 &#x2F;1024&#x2F; 8MB，约为12.5MB<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>运行一个月占用的内存为 375MB，一年占用的内存容量为 4.5G</p><p>由此可见，使用 bitmap 可以节省大量的内存资源</p><h3 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h3><ul><li>bitmap 是 string 类型，单个值最大可以使用的内存容量为 512MB</li><li>setbit 时是设置每个 value 的偏移量，可以有较大耗时</li><li>bitmap 不是绝对好，用在合适的场景最好</li></ul><p>有关 redis bitmap 的更详细知识可以参考掘金的 dzzgml 写的<a target="_blank" rel="noopener" href="https://juejin.im/post/5a7dcad0f265da4e6f17d942">Redis-BitMap</a></p><h2 id="3-5-HyperLogLog"><a href="#3-5-HyperLogLog" class="headerlink" title="3.5 HyperLogLog"></a>3.5 HyperLogLog</h2><p>Redis 在 2.8.9 版本添加了 HyperLogLog 结构。</p><p>Redis HyperLogLog 是用来做基数统计的算法，HyperLogLog 的优点是，<strong>在输入元素的数量或者体积非常非常大时，计算基数所需的空间总是固定的、并且是很小的</strong> 。</p><p>在 Redis 里面，每个 HyperLogLog 键只需要花费 12 KB 内存，就可以计算接近 2^64 个不同元素的基数。这和计算基数时，元素越多耗费内存就越多的集合形成鲜明对比。</p><p>但是，因为 HyperLogLog 只会根据输入元素来计算基数，而不会储存输入元素本身，所以 HyperLogLog 不能像集合那样，返回输入的各个元素。</p><blockquote><p>什么是基数?<br>比如数据集 {1，2,1,2} 那么这个数据集的基数集为 {1，2}, 基数(不重复元素)为 2。 基数估计就是在误差可接受的范围内，快速计算基数。</p></blockquote><h4 id="命令-1"><a href="#命令-1" class="headerlink" title="命令"></a>命令</h4><ul><li>PFADD key element [element …] 新增元素</li><li>PFCOUNT key [key…] 获取基数的估计值</li><li>PFMERGE destkey sourcekey [sourcekey] 将多个 HyperLogLog 合并为一个 HyperLogLog</li></ul><h3 id="命令演示"><a href="#命令演示" class="headerlink" title="命令演示"></a>命令演示</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> PFADD 2020_02_09:unique:ids <span class="token string">'uuid-1'</span> <span class="token string">'uuid-2'</span> <span class="token string">'uuid-3'</span> <span class="token string">'uuid-4'</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> PFCOUNT 2020_02_09:unique:ids
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">4</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> PFADD 2020_02_09:unique:ids <span class="token string">'uuid-1'</span> <span class="token string">'uuid-90'</span>
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> PFCOUNT 2020_02_09:unique:ids
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">5</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>向其中注入 100000 条数据，看看数据库的大小变化如何</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 注入数据之前</span>
<span class="token comment"># Memory</span>
used_memory:830624
used_memory_human:811.16K
used_memory_rss:7327744
used_memory_peak:908432
used_memory_peak_human:887.14K
used_memory_lua:33792
mem_fragmentation_ratio:8.82
mem_allocator:jemalloc-3.6.0

<span class="token comment"># 注入数据之后(with HyperLogLog)</span>
<span class="token comment"># Memory</span>
used_memory:890456
used_memory_human:869.59K
used_memory_rss:10792960
used_memory_peak:18084664
used_memory_peak_human:17.25M
used_memory_lua:33792
mem_fragmentation_ratio:12.12
mem_allocator:jemalloc-3.6.0


<span class="token comment"># 注入数据之后(without HyperLogLog)</span>
<span class="token comment"># Memory</span>
used_memory:9760408
used_memory_human:9.31M
used_memory_rss:18481152
used_memory_peak:18084664
used_memory_peak_human:17.25M
used_memory_lua:33792
mem_fragmentation_ratio:1.89
mem_allocator:jemalloc-3.6.0
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>很明显，使用 HyperLogLog 注入 10 万条数据占用的内存为 869.59K -811.16K = <strong>58.43k</strong> , 而直接使用 set 键值对的方法，占用的内存接近<strong>9M</strong> 。</p><p>这个差距是非常巨大的，但是天下没有免费的午餐，那么 HyperLogLog 低内存的代价是什么呢？</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:637<span class="token operator"><span class="token file-descriptor important">9</span>></span> PFCOUNT loglog
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">99556</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>查询一下基数估计值，发现并不是我们所插入的 10 万条那么多。</p><p>这就引出了 HyperLogLog 的一个最大的缺点，<strong>有一定的错误率</strong> ，根据官方的数据来看，这个错误率大约是 0.81%.</p><p>同时，HyperLogLog 还有一个很显著的缺点，在于 <strong>没法取出单条数据</strong> 。</p><p>综上，在使用 HyperLogLog 之前，<em>一定要衡量好是否可以接受它的缺点所带来的损失</em> 。</p><h3 id="补充-1"><a href="#补充-1" class="headerlink" title="补充"></a>补充</h3><p>更多关于 HyperLogLog 的知识可以看<a target="_blank" rel="noopener" href="http://www.rainybowe.com/blog/2017/07/13/%E7%A5%9E%E5%A5%87%E7%9A%84HyperLogLog%E7%AE%97%E6%B3%95/index.html">rainybowe 的 blog</a></p><h2 id="3-6-GEO-geospatial"><a href="#3-6-GEO-geospatial" class="headerlink" title="3.6 GEO(geospatial)"></a>3.6 GEO(geospatial)</h2><blockquote><p>GEO 特性是 Redis 3.2 版本的特性</p></blockquote><p>官网的介绍如下，总的来说，就是用来进行地理位置的相关操作的(如：存储经纬度，计算两地距离，范围计算等)</p><pre class="line-numbers language-none"><code class="language-none">Adds the specified geospatial items (latitude, longitude, name) to the specified key. Data is stored into the key as a sorted set, in a way that makes it possible to later retrieve items using a query by radius with theGEORADIUS or GEORADIUSBYMEMBER commands.

The command takes arguments in the standard format x,y so the longitude must be specified before the latitude. There are limits to the coordinates that can be indexed: areas very near to the poles are not indexable. The exact limits, as specified by EPSG:900913 &#x2F; EPSG:3785 &#x2F; OSGEO:41001 are the following:

    Valid longitudes are from -180 to 180 degrees.
    Valid latitudes are from -85.05112878 to 85.05112878 degrees.

The command will report an error when the user attempts to index coordinates outside the specified ranges.

Note: there is no GEODEL command because you can use ZREM in order to remove elements. The Geo index structure is just a sorted set.<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="常用命令-2"><a href="#常用命令-2" class="headerlink" title="常用命令"></a>常用命令</h3><ul><li><p>geoadd key longitude latitude member [longitude latitude member …] 增加地理位置信息 预处理</p></li><li><p>geopos key member [member …] 获取地理位置信息</p></li><li><p>geodist key member1 member2 [unit] 获取两个地理位置之间的距离</p></li><li><p>GEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [ASC|DESC] [COUNT count] 获取指定位置范围的地理信息位置集合</p><ul><li>WITHDIST ： 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致</li><li>WITHCOORD ： 将位置元素的经度和维度也一并返回</li><li>WITHHASH ： 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。 命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式</li><li>COUNT ： 指定返回结果的数量</li><li>ASC ： 根据中心的位置， 按照从近到远的方式返回位置元素。DESC ： 根据中心的位置， 按照从远到近的方式返回位置元素</li><li>store key ： 将返回结果的地理位置信息保存到指定键</li><li>storedist key ：将返回结果距离中心节点的距离保存到指定键</li></ul></li><li><p>GEORADIUSBYMEMBER key member radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [ASC|DESC] [COUNT count] 获取指定元素范围的地理信息位置集合</p></li></ul><h3 id="命令演示-1"><a href="#命令演示-1" class="headerlink" title="命令演示"></a>命令演示</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEOADD cities:locations <span class="token number">116.28</span> <span class="token number">39.55</span> bejing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEOADD cities:locations <span class="token number">117.12</span> <span class="token number">39.08</span> tianjing
<span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">1</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEOADD cities:locations <span class="token number">114.29</span> <span class="token number">38.02</span> shijiazhuang <span class="token number">118.01</span> <span class="token number">39.38</span> tangshan <span class="token number">115.29</span> <span class="token number">38.51</span> baoding <span class="token punctuation">(</span>integer<span class="token punctuation">)</span> <span class="token number">3</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEOPOS cities:locations tianjing
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"117.12000042200088501"</span>
   <span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"39.0800000535766543"</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEODIST cities:locations bejing tianjing
<span class="token string">"89206.0576"</span>
<span class="token number">127.0</span>.0.1:6379<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">></span> GEORADIUSBYMEMBER cities:locations bejing <span class="token number">150</span> km
<span class="token number">1</span><span class="token punctuation">)</span> <span class="token string">"bejing"</span>
<span class="token number">2</span><span class="token punctuation">)</span> <span class="token string">"tianjing"</span>
<span class="token number">3</span><span class="token punctuation">)</span> <span class="token string">"tangshan"</span>
<span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"baoding"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h3><p>例如</p><ul><li>微信<strong>摇一摇</strong>功能(即：<em>检索特定地理范围内的使用者</em>)</li><li>美团<strong>附近美食</strong></li></ul><h3 id="补充-2"><a href="#补充-2" class="headerlink" title="补充"></a>补充</h3><p>更多的 GEO 知识可以参看<a target="_blank" rel="noopener" href="https://blog.huangz.me/diary/2015/redis-geo.html">Redis GEO 特性简介</a> 和 <a target="_blank" rel="noopener" href="https://juejin.im/post/5c525f696fb9a049aa6f806a">Redis GEO &amp; 实现原理深度分析</a></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>到这里，Redis 的基础部分就算是告一段落了。<br>虽然不知道接下来应该如何安排。<br>再接再厉吧。</p></div><div id="reward-container"><span class="hty-icon-button button-glow" id="reward-button" title="打赏" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === &quot;none&quot;) ? &quot;block&quot; : &quot;none&quot;;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-hand-coin-line"></use></svg></span><div id="reward-comment">I'm so cute. Please give me money.</div><div id="qr" style="display:none"><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/IMG_3741.JPG"><img loading="lazy" src="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/IMG_3741.JPG" alt="支付宝" title="支付宝"></a><div><span style="color:#00a3ee"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-alipay-line"></use></svg></span></div></div><div style="display:inline-block"></div><div style="display:inline-block"><a target="_blank" rel="noopener" href="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/IMG_3742.JPG"><img loading="lazy" src="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/IMG_3742.JPG" alt="微信支付" title="微信支付"></a><div><span style="color:#2dc100"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-pay-line"></use></svg></span></div></div></div></div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>harumonia</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="https://blog.harumonia.moe/2020-02-12-redis-note-2/" title="redis学习笔记(2)">https://blog.harumonia.moe/2020-02-12-redis-note-2/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a>许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/2020-02-13-PV-spider-of-bilibili/" rel="prev" title="关于B站视频的访问量爬虫"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">关于B站视频的访问量爬虫</span></a></div><div class="post-nav-item"><a class="post-nav-next" href="/2020-02-09-redis-note-1/" rel="next" title="redis学习笔记(1)"><span class="post-nav-text">redis学习笔记(1)</span><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-right-s-line"></use></svg></a></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div><div id="valine-container"></div><script>Yun.utils.getScript("https://cdn.jsdelivr.net/npm/valine@latest/dist/Valine.min.js", () => {
  const valineConfig = {"enable":true,"appId":"r4JnhWDHnAkpVuaNKYAjM4rG-MdYXbMMI","appKey":"V82g09a4cwRrbvD1eTpo6SVt","placeholder":"Just go go","avatar":null,"meta":["nick","mail","link"],"pageSize":10,"visitor":true,"highlight":true,"recordIP":true,"enableQQ":true,"el":"#valine-container","lang":"zh-cn"}
  valineConfig.path = "/2020-02-12-redis-note-2/"
  new Valine(valineConfig)
}, window.Valine);</script></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; 2018 – 2021 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author">harumonia</span></div><div class="live_time"><span>本博客已萌萌哒地运行</span><span id="display_live_time"></span><span class="moe-text">(●'◡'●)</span><script>function blog_live_time() {
  setTimeout(blog_live_time, 1000);
  const start = new Date('2018-10-25T00:00:00');
  const now = new Date();
  const timeDiff = (now.getTime() - start.getTime());
  const msPerMinute = 60 * 1000;
  const msPerHour = 60 * msPerMinute;
  const msPerDay = 24 * msPerHour;
  const passDay = Math.floor(timeDiff / msPerDay);
  const passHour = Math.floor((timeDiff % msPerDay) / 60 / 60 / 1000);
  const passMinute = Math.floor((timeDiff % msPerHour) / 60 / 1000);
  const passSecond = Math.floor((timeDiff % msPerMinute) / 1000);
  display_live_time.innerHTML = " " + passDay + " 天 " + passHour + " 小时 " + passMinute + " 分 " + passSecond + " 秒";
}
blog_live_time();</script></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a><a class="popup-trigger hty-icon-button icon-search" id="search" target="_blank" rel="noopener" href="https://www.google.com/search?q=site:harumonia.moe" title="搜索"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-search-line"></use></svg></span></a></div></body></html>