<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.1.1"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/pace/1.0.2/themes/silver/pace-theme-center-atom.min.css"><script src="//cdn.bootcdn.net/ajax/libs/pace/1.0.2/pace.min.js"></script><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"blog.harumonia.moe",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"mac"},back2top:{enable:!0,sidebar:!0,scrollpercent:!0},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!0,lazyload:!0,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="感觉已经一万年没有更新博客了。。。这次是制作一个简单的爬虫。 前言本学期有一门纯文科的课程，名唤“医疗仪器原理”。谓之纯文科，自然是要背诵的题目太多了，多到了梦回高中历史的地步&#x3D; &#x3D;。 授课老师喜欢使用雨课堂发布习题，但是雨课堂没有办法导出题目和答案，想要整理就只能一条一条地复制粘贴，更骚的是，这个网站的题目默认被转成了图片格式(？？？)。好嘛，复制粘贴都做不到了。  这种复习的效率实在是太低了，"><meta property="og:type" content="article"><meta property="og:title" content="雨课堂习题爬虫+文字识别"><meta property="og:url" content="https://blog.harumonia.moe/2020-04-29-rain-classroom-exercises-spider-and-OCR/index.html"><meta property="og:site_name" content="Zaxon"><meta property="og:description" content="感觉已经一万年没有更新博客了。。。这次是制作一个简单的爬虫。 前言本学期有一门纯文科的课程，名唤“医疗仪器原理”。谓之纯文科，自然是要背诵的题目太多了，多到了梦回高中历史的地步&#x3D; &#x3D;。 授课老师喜欢使用雨课堂发布习题，但是雨课堂没有办法导出题目和答案，想要整理就只能一条一条地复制粘贴，更骚的是，这个网站的题目默认被转成了图片格式(？？？)。好嘛，复制粘贴都做不到了。  这种复习的效率实在是太低了，"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://i.loli.net/2020/04/29/WhZH5pTk1MvJULc.png"><meta property="og:image" content="https://i.loli.net/2020/04/29/SPQrEik3UldRMX9.png"><meta property="og:image" content="https://i.loli.net/2020/04/29/1Yec5JlBIDnx7bQ.png"><meta property="og:image" content="https://i.loli.net/2020/04/29/Iek1qN6YBwfJSbn.png"><meta property="article:published_time" content="2020-04-29T14:51:00.000Z"><meta property="article:modified_time" content="2020-05-05T16:08:28.000Z"><meta property="article:author" content="harumonia"><meta property="article:tag" content="spider"><meta property="article:tag" content="自制学习小工具"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://i.loli.net/2020/04/29/WhZH5pTk1MvJULc.png"><link rel="canonical" href="https://blog.harumonia.moe/2020-04-29-rain-classroom-exercises-spider-and-OCR/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>雨课堂习题爬虫+文字识别 | Zaxon</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><script>fetch("https://v1.hitokoto.cn/?c=i").then(function(t){return t.json()}).then(function(t){var o=document.getElementById("hitokoto"),n=document.getElementById("hitofrom");o.innerHTML=t.hitokoto,n.innerHTML="--- "+t.from}).catch(function(t){console.error(t)})</script></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container use-motion"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Zaxon</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">Find the key of soul</p><p class="site-hit" id="hitokoto"></p><p class="site-hit" id="hitofrom"></p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-fab fa-home"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-fab fa-user"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-fab fa-tags"></i>标签<span class="badge">57</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-fab fa-th"></i>分类<span class="badge">19</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-fab fa-archive"></i>归档<span class="badge">107</span></a></li><li class="menu-item menu-item-book"><a href="/books/" rel="section"><i class="fa fa-fw fa-fab fa-book"></i>图书</a></li><li class="menu-item menu-item-movie"><a href="/movies/" rel="section"><i class="fa fa-fw fa-fab fa-film"></i>电影</a></li><li class="menu-item menu-item-game"><a href="/games/" rel="section"><i class="fa fa-fw fa-fab fa-gamepad"></i>游戏</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="reading-progress-bar"></div><a href="https://github.com/zxjlm" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://blog.harumonia.moe/2020-04-29-rain-classroom-exercises-spider-and-OCR/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/Ocabe.webp"><meta itemprop="name" content="harumonia"><meta itemprop="description" content="lazy"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Zaxon"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">雨课堂习题爬虫+文字识别</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-04-29 14:51:00" itemprop="dateCreated datePublished" datetime="2020-04-29T14:51:00+00:00">2020-04-29</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-05-05 16:08:28" itemprop="dateModified" datetime="2020-05-05T16:08:28+00:00">2020-05-05</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%BA%90%E6%B5%81%E6%B8%85%E6%B3%89/" itemprop="url" rel="index"><span itemprop="name">源流清泉</span></a> </span>， <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/%E6%BA%90%E6%B5%81%E6%B8%85%E6%B3%89/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a> </span></span><span id="/2020-04-29-rain-classroom-exercises-spider-and-OCR/" class="post-meta-item leancloud_visitors" data-flag-title="雨课堂习题爬虫+文字识别" title="阅读次数"><span class="post-meta-item-icon"><i class="fa fa-eye"></i> </span><span class="post-meta-item-text">阅读次数：</span> <span class="leancloud-visitors-count"></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Valine：</span> <a title="valine" href="/2020-04-29-rain-classroom-exercises-spider-and-OCR/#valine-comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2020-04-29-rain-classroom-exercises-spider-and-OCR/" itemprop="commentCount"></span></a></span><br><span class="post-meta-item" title="本文字数"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i> </span><span class="post-meta-item-text">本文字数：</span> <span>4.3k</span> </span><span class="post-meta-item" title="阅读时长"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i> </span><span class="post-meta-item-text">阅读时长 &asymp;</span> <span>13 分钟</span></span></div></header><div class="post-body" itemprop="articleBody"><p>感觉已经一万年没有更新博客了。。。这次是制作一个简单的爬虫。</p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本学期有一门纯文科的课程，名唤“医疗仪器原理”。谓之纯文科，自然是要背诵的题目太多了，多到了梦回高中历史的地步= =。</p><p>授课老师喜欢使用雨课堂发布习题，但是雨课堂没有办法导出题目和答案，想要整理就只能一条一条地复制粘贴，更骚的是，这个网站的题目默认被转成了图片格式(？？？)。好嘛，复制粘贴都做不到了。</p><p><img data-src="https://i.loli.net/2020/04/29/WhZH5pTk1MvJULc.png" alt="图片.png"></p><p>这种复习的效率实在是太低了，于是准备重操旧业，开始爬虫工程（面向监狱编程）</p><a id="more"></a><h2 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h2><h3 id="S1-抓包分析"><a href="#S1-抓包分析" class="headerlink" title="S1 抓包分析"></a>S1 抓包分析</h3><p>在进行交互分析之后，发现了一个有趣的链接，这个链接的文本量大得出奇，而且类型是 json！~一般这样的链接，就是我们交互分析的最终目标了。</p><p><img data-src="https://i.loli.net/2020/04/29/SPQrEik3UldRMX9.png" alt="图片.png"></p><p>这样一来，数据来源问题就解决了。</p><p>继续分析，他所有的题目和答案都是保存为图片，然后给出了一个图片链接。第一次见到这种奇葩的设计，难道是为了防止我这种”数据小偷”吗?</p><p>图片可以直接抓下来，但是就这样贴到笔记本上，十分地麻烦，关键是不美观啊。</p><p>于是想到了一个解决方案，OCR~</p><h3 id="S2-OCR"><a href="#S2-OCR" class="headerlink" title="S2 OCR"></a>S2 OCR</h3><p>这里我选择直接使用百度的 OCR api，百度家的识别率不错，而且文档也挺齐全的，这里就不多做赘述了，直接放上<a target="_blank" rel="noopener" href="https://cloud.baidu.com/doc/OCR/s/Sk3h7xyad">文档链接</a>。</p><p>不过在识别的过程中倒是出现了一个小插曲。</p><h4 id="png-问题"><a href="#png-问题" class="headerlink" title="png 问题"></a>png 问题</h4><p>第一次识别之后，明明本地每个文字都很清楚，但是识别结果就是空。由于这是一个黑盒的过程，我也不知道中间到底是出了什么问题。</p><p>我能想到的第一个解决思路就是尽量拆解黑盒。于是我又找了一家 OCR，然后就发现过程中出现了这样的情况。</p><p><img data-src="https://i.loli.net/2020/04/29/1Yec5JlBIDnx7bQ.png" alt="截屏2020-04-29下午1.42.30.png"></p><p>无背景的 png 格式的图片，上传之后背景默认被填充为了黑色，这样就与原本的文字颜色(黑色)冲突了，直接把文字给同化了。</p><h3 id="图像预处理"><a href="#图像预处理" class="headerlink" title="图像预处理"></a>图像预处理</h3><p>我对于数字图像的本质理解并不是很深刻，无法从编码层面解决问题，不过条条大路通罗马。</p><p>我的解决思路就是对图像进行一个预处理，赋予图像一个背景颜色，然后再进行 OCR。这个背景颜色自然是与文字颜色越泾渭分明越好，于是选择了白色。</p><p><img data-src="https://i.loli.net/2020/04/29/Iek1qN6YBwfJSbn.png" alt="1.png"></p><p>如此，清晰明了。进行 OCR 之后，顺利识别出了我们需要的内容。</p><h3 id="S3-爬虫"><a href="#S3-爬虫" class="headerlink" title="S3 爬虫"></a>S3 爬虫</h3><h4 id="S3-1-批量分析"><a href="#S3-1-批量分析" class="headerlink" title="S3.1 批量分析"></a>S3.1 批量分析</h4><p>真的是有够别扭的，雨课堂所有的答案也是保存为图片格式的，最令人发指的是，他的选择题竟然是拆分的图片，也就是说，一个 ABCD 四项的选择题，连上题目一共有 5 张图。。。</p><h4 id="S3-2-区分题型"><a href="#S3-2-区分题型" class="headerlink" title="S3.2 区分题型"></a>S3.2 区分题型</h4><p>回传的数据中，并没有出现类似‘选择’、‘判断’这种能够显示地区分题型的字段。</p><p>在分析之后，发现所有的题型可以归总为三大类，选择、填空、解答。</p><p>选择题的判断很简单，选择题的答案都是由 ABCD 这样的字母构成，用正则判断是否是全英文答案即可。</p><blockquote><p>小插曲：忘记了多选题，报错。</p><p>其实无论是”A”还是”ABC”，在 python 中都是字符数组，不需要区分单选还是多选，直接遍历字符串即可。然后把得到的结果拼接起来就行了。</p></blockquote><p>解答题有一个不知道有啥用的特殊字段，正好我们可以那然作为判断标志。</p><p>剩下来的就是填空题咯。</p><h3 id="S4-结果"><a href="#S4-结果" class="headerlink" title="S4 结果"></a>S4 结果</h3><p>最终爬虫的结果如下（部分）</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">7 :   尿液分析仪通常由[填空1]填空2]和[填空3]三部分组成</span><br><span class="line"> &#123;&#39;1&#39;: &#39;机械系统&#39;, &#39;2&#39;: &#39;光学系统&#39;, &#39;3&#39;: &#39;电路系统&#39;&#125;</span><br><span class="line">8 :   临床应用最普遍的自动化血培养检测系统主要有利用感受器的[填空1和利用培养基中变化的[填空2两种检测技术。</span><br><span class="line"> &#123;&#39;1&#39;: &#39;比色法&#39;, &#39;2&#39;: &#39;荧光测定法&#39;&#125;</span><br><span class="line">9 :   聚合酶链反应技术类似于DNA的天然复制过程,其特异性依赖于靶序列两端互补的寡核苷酸引物,由[填空们、[填空2]、[填空3]三个基本反应步骤构成。</span><br><span class="line"> &#123;&#39;1&#39;: &#39;变性&#39;, &#39;2&#39;: &#39;退火&#39;, &#39;3&#39;: &#39;延伸&#39;&#125;</span><br><span class="line">10 :   血液细胞分析仪的血细胞计数原理是()</span><br><span class="line"> 电阻抗脉冲法</span><br><span class="line">11 :   使用鞘流技术的设备是()</span><br><span class="line"> 流式细胞仪</span><br><span class="line">12 :   流式细胞仪的荧光检测使用()</span><br><span class="line"> 光电倍增管</span><br><span class="line">13 :   全自动血凝仪基本组成不包括</span><br><span class="line"> 紫外线产生系统</span><br></pre></td></tr></table></figure><p>识别率尚可~</p><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">ans_dic = &#123;<span class="string">&#x27;A&#x27;</span>:<span class="number">1</span>,<span class="string">&#x27;B&#x27;</span>:<span class="number">2</span>,<span class="string">&#x27;C&#x27;</span>:<span class="number">3</span>,<span class="string">&#x27;D&#x27;</span>:<span class="number">4</span>&#125;</span><br><span class="line">url = <span class="string">&#x27;https://www.yuketang.cn/v2/api/web/quiz/quiz_result?classroom_id=*****&amp;quiz_id=****&#x27;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    涉及隐私，战术打码</span><br><span class="line">&#125;</span><br><span class="line">req = requests.get(url,headers=headers)</span><br><span class="line">slides = req.json()[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;Slides&#x27;</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pic_process</span>(<span class="params">pic_path</span>):</span></span><br><span class="line">    im = Image.open(pic_path)</span><br><span class="line">    x,y = im.size</span><br><span class="line">    p = Image.new(<span class="string">&#x27;RGBA&#x27;</span>, im.size, (<span class="number">255</span>,<span class="number">255</span>,<span class="number">255</span>))</span><br><span class="line">    p.paste(im, (<span class="number">0</span>, <span class="number">0</span>, x, y), im)</span><br><span class="line">    pic_processed_path = pic_path.replace(<span class="string">&#x27;pre_process&#x27;</span>,<span class="string">&#x27;process&#x27;</span>)</span><br><span class="line">    p.save(pic_processed_path)</span><br><span class="line">    <span class="keyword">return</span> pic_processed_path</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ocr</span>(<span class="params">pic_processed_path</span>):</span></span><br><span class="line">    request_url = <span class="string">&quot;https://aip.baidubce.com/rest/2.0/ocr/v1/general_basic&quot;</span></span><br><span class="line">    f = open(pic_processed_path, <span class="string">&#x27;rb&#x27;</span>)</span><br><span class="line">    img = base64.b64encode(f.read())</span><br><span class="line"></span><br><span class="line">    params = &#123;<span class="string">&quot;image&quot;</span>:img&#125;</span><br><span class="line">    access_token = 继续打码</span><br><span class="line">    request_url = request_url + <span class="string">&quot;?access_token=&quot;</span> + access_token</span><br><span class="line">    headers = &#123;<span class="string">&#x27;content-type&#x27;</span>: <span class="string">&#x27;application/x-www-form-urlencoded&#x27;</span>&#125;</span><br><span class="line">    response = requests.post(request_url, data=params, headers=headers)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;words_result&#x27;</span> <span class="keyword">in</span> list(response.json().keys()):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join([foo[<span class="string">&#x27;words&#x27;</span>] <span class="keyword">for</span> foo <span class="keyword">in</span> response.json()[<span class="string">&#x27;words_result&#x27;</span>]])</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(pic_processed_path,<span class="string">&#x27;failed.&#x27;</span>,response.json())</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> range(len(slides)):</span><br><span class="line">    answer = slides[index][<span class="string">&#x27;result&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> isinstance(answer,str) <span class="keyword">and</span> len(re.match(<span class="string">&#x27;(\D+)&#x27;</span>,answer).groups()[<span class="number">0</span>]) == len(answer):</span><br><span class="line">        fin_answer = []</span><br><span class="line">        <span class="keyword">for</span> foo <span class="keyword">in</span> answer:</span><br><span class="line">            name = re.match(<span class="string">&#x27;.*?cn/(.*)&#x27;</span>,slides[index][<span class="string">&#x27;Shapes&#x27;</span>][ans_dic[foo]][<span class="string">&#x27;URL&#x27;</span>]).group(<span class="number">1</span>)</span><br><span class="line">            pic_url = slides[index][<span class="string">&#x27;Shapes&#x27;</span>][ans_dic[foo]][<span class="string">&#x27;URL&#x27;</span>]</span><br><span class="line">            req_pic = requests.get(pic_url)</span><br><span class="line">            pic_path = <span class="string">&#x27;yuketang_pic/pre_process/&#x27;</span>+name+<span class="string">&#x27;.png&#x27;</span></span><br><span class="line">            <span class="keyword">with</span> open(pic_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">                file.write(req_pic.content)</span><br><span class="line">            pic_process_path = pic_process(pic_path)</span><br><span class="line">            answer = ocr(pic_process_path)</span><br><span class="line">            fin_answer.append(answer)</span><br><span class="line">        answer = <span class="string">&#x27;,&#x27;</span>.join(fin_answer)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;is_subject_finish&#x27;</span> <span class="keyword">in</span> slides[index].keys():</span><br><span class="line">        answer = slides[index][<span class="string">&#x27;Problem&#x27;</span>][<span class="string">&#x27;Remark&#x27;</span>]</span><br><span class="line"></span><br><span class="line">    name = re.match(<span class="string">&#x27;.*?cn/(.*)&#x27;</span>,slides[index][<span class="string">&#x27;Shapes&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;URL&#x27;</span>]).group(<span class="number">1</span>)</span><br><span class="line">    pic_url = slides[index][<span class="string">&#x27;Shapes&#x27;</span>][<span class="number">0</span>][<span class="string">&#x27;URL&#x27;</span>]</span><br><span class="line">    req_pic = requests.get(pic_url)</span><br><span class="line">    pic_path = <span class="string">&#x27;yuketang_pic/pre_process/&#x27;</span>+name+<span class="string">&#x27;.png&#x27;</span></span><br><span class="line">    <span class="keyword">with</span> open(pic_path, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">        file.write(req_pic.content)</span><br><span class="line">    pic_process_path = pic_process(pic_path)</span><br><span class="line">    ques = ocr(pic_process_path)</span><br><span class="line">    print(index,<span class="string">&quot;:  &quot;</span>,ques,<span class="string">&#x27;\n&#x27;</span>,answer)</span><br></pre></td></tr></table></figure><h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>日常表白 tt，晚上早点睡觉哦</p></div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者： </strong>harumonia</li><li class="post-copyright-link"><strong>本文链接：</strong> <a href="https://blog.harumonia.moe/2020-04-29-rain-classroom-exercises-spider-and-OCR/" title="雨课堂习题爬虫+文字识别">https://blog.harumonia.moe/2020-04-29-rain-classroom-exercises-spider-and-OCR/</a></li><li class="post-copyright-license"><strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/CC%20BY-NC-SA%204.0/4.0/" rel="noopener" target="_blank"><i class="fa fa-fw fa-creative-commons"></i>CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li></ul></div><footer class="post-footer"><div class="post-tags"><a href="/tags/spider/" rel="tag"><i class="fa fa-tag"></i> spider</a> <a href="/tags/%E8%87%AA%E5%88%B6%E5%AD%A6%E4%B9%A0%E5%B0%8F%E5%B7%A5%E5%85%B7/" rel="tag"><i class="fa fa-tag"></i> 自制学习小工具</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2020-04-04-catch-rain/" rel="prev" title="(打卡)接雨水"><i class="fa fa-chevron-left"></i> (打卡)接雨水</a></div><div class="post-nav-item"><a href="/2020-05-04-a-Automatic-clocking-script/" rel="next" title="自动化的每日打卡工具v1.1">自动化的每日打卡工具v1.1 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><div class="comments" id="valine-comments"></div><script>window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B"><span class="nav-number">2.</span> <span class="nav-text">开始</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#S1-%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90"><span class="nav-number">2.1.</span> <span class="nav-text">S1 抓包分析</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#S2-OCR"><span class="nav-number">2.2.</span> <span class="nav-text">S2 OCR</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#png-%E9%97%AE%E9%A2%98"><span class="nav-number">2.2.1.</span> <span class="nav-text">png 问题</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%BE%E5%83%8F%E9%A2%84%E5%A4%84%E7%90%86"><span class="nav-number">2.3.</span> <span class="nav-text">图像预处理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#S3-%E7%88%AC%E8%99%AB"><span class="nav-number">2.4.</span> <span class="nav-text">S3 爬虫</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#S3-1-%E6%89%B9%E9%87%8F%E5%88%86%E6%9E%90"><span class="nav-number">2.4.1.</span> <span class="nav-text">S3.1 批量分析</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#S3-2-%E5%8C%BA%E5%88%86%E9%A2%98%E5%9E%8B"><span class="nav-number">2.4.2.</span> <span class="nav-text">S3.2 区分题型</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#S4-%E7%BB%93%E6%9E%9C"><span class="nav-number">2.5.</span> <span class="nav-text">S4 结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%80%E5%90%8E"><span class="nav-number">4.</span> <span class="nav-text">最后</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="harumonia" src="https://harumona-blog.oss-cn-beijing.aliyuncs.com/blog/Ocabe.webp"><p class="site-author-name" itemprop="name">harumonia</p><div class="site-description" itemprop="description">lazy</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">107</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">19</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">57</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/zxjlm" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zxjlm" rel="noopener" target="_blank"><i class="fa fa-fw fa-fab fa-github"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:zxjlm233@gmail.com" title="E-Mail → mailto:zxjlm233@gmail.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-fab fa-envelope"></i>E-Mail</a></span></div></div><div class="back-to-top motion-element"><i class="fa fa-arrow-up"></i> <span>0%</span></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2017 – <span itemprop="copyrightYear">2020</span> <span class="with-love"><i class="fa fa-fab fa-asterisk"></i> </span><span class="author" itemprop="copyrightHolder">harumonia</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-area-chart"></i> </span><span class="post-meta-item-text">站点总字数：</span> <span title="站点总字数">369k</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="fa fa-coffee"></i> </span><span class="post-meta-item-text">站点阅读时长 &asymp;</span> <span title="站点阅读时长">19:12</span></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script><script src="//cdn.jsdelivr.net/npm/lozad@1/dist/lozad.min.js"></script><script src="/lib/velocity/velocity.min.js"></script><script src="/lib/velocity/velocity.ui.min.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script><script>NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//cdnjs.cloudflare.com/ajax/libs/valine/1.3.10/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : true,
      appId      : 'MRbMQ94D5q51YRYIbsRF0kcH-gzGzoHsz',
      appKey     : 'A9JJBbjhfc9liCzCJgWIxpDa',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : true,
      lang       : 'zh-cn' || 'zh-cn',
      path       : location.pathname,
      recordIP   : true,
      serverURLs : ''
    });
  }, window.Valine);
});</script><script async src="/js/cursor/fireworks.js"></script></body></html>